<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNESCO Heritage Sites: Former USSR</title>
    
    <!-- MapLibre GL JS -->
    <link href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css" rel="stylesheet">
    <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
        
        .map-overlay {
            position: absolute;
            top: 70px;
            left: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 380px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            z-index: 1;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        .map-overlay.collapsed {
            transform: translateX(-420px);
            opacity: 0;
            pointer-events: none;
        }
        
        .toggle-sidebar-btn {
            color: #222;
            position: absolute;
            top: 80px;
            left: 20px;
            background: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            cursor: pointer;
            font-size: 18px;
            z-index: 2;
            transition: all 0.2s;
        }
        
        .toggle-sidebar-btn:hover {
            background: #f0f0f0;
            box-shadow: 0 2px 12px rgba(0,0,0,0.2);
        }
        
        .toggle-sidebar-btn.sidebar-open {
            left: 420px;
        }
        
        h1 {
            color: #222;
            font-size: 20px;
            margin-bottom: 10px;
            color: #222;
            line-height: 1.3;
        }
        
        .description {
            font-size: 14px;
            color: #222;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .legend {
            margin-top: 15px;
        }
        
        .legend-title {
            color: #222;
            font-weight: 600;
            font-size: 13px;
            color: #222;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .legend-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .legend-item {
            color: #222;
            display: flex;
            align-items: center;
            font-size: 12px;
            padding: 4px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            flex-shrink: 0;
        }
        
        .legend-count {
            color: #222;
            font-size: 11px;
            margin-left: auto;
            padding-left: 4px;
        }
        
        .maplibregl-popup-content {
            padding: 15px;
            max-width: 300px;
        }
        
        .popup-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            color: #222;
        }
        
        .popup-field {
            margin-bottom: 8px;
            font-size: 13px;
        }
        
        .popup-field strong {
            color: #222;
        }
        
        .popup-description {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
            font-size: 12px;
            color: #222;
            line-height: 1.4;
        }
        
        .popup-link {
            display: inline-block;
            margin-top: 10px;
            color: #0066cc;
            text-decoration: none;
            font-size: 12px;
        }
        
        .popup-link:hover {
            text-decoration: underline;
        }
        
        .zoom-reset-button {
            position: absolute;
            top: 80px;
            right: 20px;
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 1;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #222;
            border: none;
            transition: all 0.2s;
        }
        
        .zoom-reset-button:hover {
            background: #f0f0f0;
            box-shadow: 0 2px 12px rgba(0,0,0,0.2);
        }
        
        .zoom-reset-button::before {
            content: "üåç ";
            margin-right: 5px;
        }
        
        
        
        

        
        
        
        
        
        
        
        
        

        
        
        
        
        
        
        
        
        
        
        
    </style>
</head>
<body>
        <nav style="position: absolute; top: 0; left: 0; right: 0; background: rgba(255,255,255,0.95); color: #000000; padding: 15px 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 10; display: flex; gap: 15px; align-items: center;">
        <span style="font-weight: 600; font-size: 14px; color: #222;">UNESCO Heritage Atlas:</span>
        <a href="intro.html" style="color: #222; text-decoration: none; font-size: 14px; padding: 5px 10px;">Introduction</a>
        <a href="global.html" style="color: #222; text-decoration: none; font-size: 14px; padding: 5px 10px;">Global View</a>
        <a href="index.html" style="color: #0066cc; background: #e3f2fd; border-radius: 4px; text-decoration: none; font-size: 14px; padding: 5px 10px;">Regional Overview</a>
        <a href="timeline.html" style="color: #222; text-decoration: none; font-size: 14px; padding: 5px 10px;">Timeline</a>
        <a href="bukhara.html" style="color: #222; text-decoration: none; font-size: 14px; padding: 5px 10px;">Bukhara Detail</a>
        <a href="conclusion.html" style="color: #222; text-decoration: none; font-size: 14px; padding: 5px 10px;">Conclusion</a>
        <a href="contact.html" style="color: #222; text-decoration: none; font-size: 14px; padding: 5px 10px;">Contact</a>
    </nav>
    
    <div id="map"></div>
    
    <button class="toggle-sidebar-btn sidebar-open" id="toggleSidebar" title="Hide/Show Info Panel">‚óÄ</button>
    <button class="zoom-reset-button" id="resetView">Reset View</button>
    
    <div class="map-overlay" id="mapOverlay">
        <h1>Post-Soviet Heritage Strategies</h1>
        <p class="description">
            Following the USSR's collapse in 1991, fifteen newly independent states inherited identical heritage management frameworks: Soviet-era museum-reserve designations, comprehensive state property ownership, and standardized documentation systems. Yet these states deployed this inherited capacity in dramatically different ways.
        </p>
        <p class="description">
            This map shows <strong id="total-sites">UNESCO World Heritage Sites</strong> across the former Soviet Union, 
            revealing how post-independence states developed distinct strategies for presenting heritage to UNESCO.
        </p>
        <p class="description">
            <strong>The contrast between Uzbekistan and Kazakhstan is particularly instructive.</strong> Both inherited Soviet museum-reserve frameworks and comprehensive property documentation. Yet while Uzbekistan rapidly inscribed historic urban centers as ensembles (Itchan Kala 1990, Bukhara 1993, Samarkand 2001), Kazakhstan waited thirteen years before inscribing its first cultural site‚Äîthe Mausoleum of Khoja Ahmed Yasawi (2003)‚Äîas a standalone monument rather than an urban ensemble.
        </p>
        
        
        
        
        
        
        
        <div class="legend">
            <div class="legend-title">15 Former USSR States:</div>
            <div class="legend-grid" id="legend-grid">
                <!-- Legend items will be inserted dynamically -->
            </div>
        </div>
    </div>

    <script>
        // Color palette for 15 countries - distinguishable colors
        const COUNTRY_COLORS = {
            'Russia': '#e74c3c',           // Red
            'Ukraine': '#f39c12',          // Orange
            'Belarus': '#95a5a6',          // Gray
            'Kazakhstan': '#3498db',       // Blue
            'Uzbekistan': '#e67e22',       // Dark orange
            'Turkmenistan': '#16a085',     // Teal
            'Tajikistan': '#2ecc71',       // Green
            'Kyrgyzstan': '#9b59b6',       // Purple
            'Armenia': '#d35400',          // Burnt orange
            'Azerbaijan': '#27ae60',       // Darker green
            'Georgia': '#8e44ad',          // Dark purple
            'Moldova': '#c0392b',          // Dark red
            'Lithuania': '#2980b9',        // Dark blue
            'Latvia': '#f39c12',           // Gold
            'Estonia': '#1abc9c'           // Turquoise
        };

        // Initialize map
        const map = new maplibregl.Map({
            container: 'map',
            style: {
                "version": 8,
                "sources": {
                    "carto": {
                        "type": "raster",
                        "tiles": ["https://a.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png"],
                        "tileSize": 256
                    }
                },
                "layers": [{
                    "id": "background",
                    "type": "raster",
                    "source": "carto"
                }]
            },
            center: [50, 50],
            zoom: 3
        });

        // Add navigation controls
        map.addControl(new maplibregl.NavigationControl(), 'top-right');

        // Add reset view button functionality
        document.getElementById('resetView').addEventListener('click', function() {
            map.flyTo({
                center: [50, 50],
                zoom: 3,
                duration: 1500,
                essential: true
            });
        });

        // Toggle sidebar functionality
        const toggleBtn = document.getElementById('toggleSidebar');
        const overlay = document.getElementById('mapOverlay');
        let sidebarOpen = true;

        toggleBtn.addEventListener('click', function() {
            sidebarOpen = !sidebarOpen;
            
            if (sidebarOpen) {
                overlay.classList.remove('collapsed');
                toggleBtn.classList.add('sidebar-open');
                toggleBtn.innerHTML = '‚óÄ';
                toggleBtn.title = 'Hide Info Panel';
            } else {
                overlay.classList.add('collapsed');
                toggleBtn.classList.remove('sidebar-open');
                toggleBtn.innerHTML = '‚ñ∂';
                toggleBtn.title = 'Show Info Panel';
            }
        });

        // Function to get country from properties (handles transnational sites)
        function getPrimaryCountry(countryString) {
            // If it's a transnational site, return the first country
            if (countryString.includes(',')) {
                return countryString.split(',')[0].trim();
            }
            return countryString;
        }

        // Wait for map to load
        map.on('load', function() {
            // Load the GeoJSON data
            fetch('unesco_sites.geojson')
                .then(response => response.json())
                .then(data => {
                    // Count sites per country
                    const countryCounts = {};
                    data.features.forEach(feature => {
                        const country = getPrimaryCountry(feature.properties.country);
                        countryCounts[country] = (countryCounts[country] || 0) + 1;
                    });

                    // Update total sites count
                    document.getElementById('total-sites').textContent = 
                        `${data.features.length} UNESCO World Heritage Sites`;

                    // Build legend dynamically
                    const legendGrid = document.getElementById('legend-grid');
                    Object.entries(countryCounts).sort((a, b) => b[1] - a[1]).forEach(([country, count]) => {
                        const color = COUNTRY_COLORS[country] || '#95a5a6';
                        const item = document.createElement('div');
                        item.className = 'legend-item';
                        item.innerHTML = `
                            <div class="legend-color" style="background-color: ${color};"></div>
                            <span>${country}</span>
                            <span class="legend-count">(${count})</span>
                        `;
                        legendGrid.appendChild(item);
                    });

                    // Add source
                    map.addSource('unesco-sites', {
                        type: 'geojson',
                        data: data
                    });

                    // Add circle layer
                    map.addLayer({
                        'id': 'unesco-circles',
                        'type': 'circle',
                        'source': 'unesco-sites',
                        'paint': {
                            'circle-radius': [
                                'interpolate',
                                ['linear'],
                                ['zoom'],
                                2, 6,
                                8, 12
                            ],
                            'circle-color': [
                                'case',
                                ['has', 'country'],
                                [
                                    'match',
                                    ['get', 'country'],
                                    'Russia', COUNTRY_COLORS['Russia'],
                                    'Ukraine', COUNTRY_COLORS['Ukraine'],
                                    'Belarus', COUNTRY_COLORS['Belarus'],
                                    'Kazakhstan', COUNTRY_COLORS['Kazakhstan'],
                                    'Uzbekistan', COUNTRY_COLORS['Uzbekistan'],
                                    'Turkmenistan', COUNTRY_COLORS['Turkmenistan'],
                                    'Tajikistan', COUNTRY_COLORS['Tajikistan'],
                                    'Kyrgyzstan', COUNTRY_COLORS['Kyrgyzstan'],
                                    'Armenia', COUNTRY_COLORS['Armenia'],
                                    'Azerbaijan', COUNTRY_COLORS['Azerbaijan'],
                                    'Georgia', COUNTRY_COLORS['Georgia'],
                                    'Moldova', COUNTRY_COLORS['Moldova'],
                                    'Lithuania', COUNTRY_COLORS['Lithuania'],
                                    'Latvia', COUNTRY_COLORS['Latvia'],
                                    'Estonia', COUNTRY_COLORS['Estonia'],
                                    // For transnational sites, use the first country's color
                                    '#95a5a6'
                                ],
                                '#95a5a6'
                            ],
                            'circle-stroke-width': 2,
                            'circle-stroke-color': '#ffffff',
                            'circle-opacity': 0.85
                        }
                    });

                    // Create popup
                    const popup = new maplibregl.Popup({
                        closeButton: true,
                        closeOnClick: false,
                        maxWidth: '350px'
                    });

                    // Click event for popups
                    map.on('click', 'unesco-circles', function(e) {
                        const props = e.features[0].properties;
                        const coordinates = e.features[0].geometry.coordinates.slice();

                        // Truncate description if too long
                        let description = props.description;
                        if (description && description.length > 250) {
                            description = description.substring(0, 250) + '...';
                        }

                        const popupContent = `
                            <div class="popup-title">${props.name}</div>
                            <div class="popup-field"><strong>Country:</strong> ${props.country}</div>
                            <div class="popup-field"><strong>Year Inscribed:</strong> ${props.year}</div>
                            <div class="popup-field"><strong>Type:</strong> ${props.type || 'N/A'}</div>
                            ${props.criteria ? `<div class="popup-field"><strong>Criteria:</strong> ${props.criteria}</div>` : ''}
                            ${props.religious ? `<div class="popup-field"><strong>Religious Significance:</strong> ${props.religious}</div>` : ''}
                            ${description ? `<div class="popup-description">${description}</div>` : ''}
                            ${props.unesco_link ? `<a href="${props.unesco_link}" target="_blank" class="popup-link">View on UNESCO Website ‚Üí</a>` : ''}
                        `;

                        popup.setLngLat(coordinates)
                            .setHTML(popupContent)
                            .addTo(map);
                    });

                    // Change cursor on hover
                    map.on('mouseenter', 'unesco-circles', function() {
                        map.getCanvas().style.cursor = 'pointer';
                    });

                    map.on('mouseleave', 'unesco-circles', function() {
                        map.getCanvas().style.cursor = '';
                    });
                })
                .catch(error => {
                    console.error('Error loading GeoJSON:', error);
                });
        });
    </script>

    
</body>
</html>
